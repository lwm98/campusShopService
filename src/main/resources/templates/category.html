<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CIGT分类</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="/static/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="/static/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700">
    <!-- owl carousel-->
    <link rel="stylesheet" href="/static/vendor/owl.carousel/assets/owl.carousel.css">
    <link rel="stylesheet" href="/static/vendor/owl.carousel/assets/owl.theme.default.css">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="/static/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="/static/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="/static/favicon.png">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
		<!-- 头部 -->
		<link rel="import" href="/static/header.html" id="header">
		<!-- 底部 -->
		<link rel="import" href="/static/footer.html" id="footer">
	<style type="text/css">
		.el-pagination.is-background .el-pager li:not(.disabled).active{
			background-color: #4fbfa8;
		}
		.el-pagination.is-background .el-pager li {
		    background-color:white;
		}
		.el-pagination.is-background .btn-next{
			background-color:white;
		}
		.el-pagination.is-background .btn-prev{
			background-color:white;
		}
	</style>
  </head>
  <body>
   <script>
   		document.write(header.import.body.innerHTML);
   </script>
   
   <div id="CIGTcategory">
   
    <div id="all">
      <div id="content">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <!-- breadcrumb-->
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="index">首页</a></li>
				  <li class="breadcrumb-item"><a href="category">闲置商品</a></li>
                  <li aria-current="page" class="breadcrumb-item active">{{type.category}}</li>
                </ol>
              </nav>
            </div>
            <div class="col-lg-3">
              <!--
              *** MENUS AND FILTERS ***
              _________________________________________________________
              -->
              <div class="card sidebar-menu mb-4">
                <div class="card-header">
                  <h3 class="h4 card-title">类别</h3>
                </div>
                <div class="card-body">
                  <ul class="nav nav-pills flex-column category-menu">
                  <!--  <li><a href="category.html" class="nav-link">全新商品 <span class="badge badge-secondary">0</span></a>
                     <ul class="list-unstyled">
                       <li><a href="category.html" class="nav-link">秋裤</a></li>
                       <li><a href="category.html" class="nav-link">运动短裤</a></li>
                       <li><a href="category.html" class="nav-link">工装裤</a></li>
                       <li><a href="category.html" class="nav-link">半身裙</a></li>
                     </ul>
                    </li> -->
                 <!--   <li><a href="category.html" class="nav-link active">Ladies  <span class="badge badge-light">123</span></a>
                      <ul class="list-unstyled">
                        <li><a href="category.html" class="nav-link">T-shirts</a></li>
                        <li><a href="category.html" class="nav-link">Skirts</a></li>
                        <li><a href="category.html" class="nav-link">Pants</a></li>
                        <li><a href="category.html" class="nav-link">Accessories</a></li>
                      </ul>
                    </li> -->
                    <li><a href="category" class="nav-link">闲置商品  <span class="badge badge-secondary"></span></a>
                      <ul class="list-unstyled">
                        <li v-for="(item,index) in typelist" :key="index">
                      		<a href="javascript:;" class="nav-link" @click="ChangeType(item,1)" >{{item.category}}</a>
                      	</li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="banner"><a href="#"><img src="/static/img/banner.jpg" alt="sales 2014" class="img-fluid"></a></div>
            </div>
            <div class="col-lg-9">
              <div class="box">
                <h1>{{type.category}}</h1>
                <p>在我们的平台，我们提供我们在全球范围内找到并精心挑选的各种最好的产品。</p>
              </div>
              <div class="box info-bar">
                <div class="row">
                  <div class="col-md-12 col-lg-4 products-showing">每页展示产品中的<strong>8</strong>种</div>
                  <div class="col-md-12 col-lg-7 products-number-sort">
                    <form class="form-inline d-block d-lg-flex justify-content-between flex-column flex-md-row">
                      <div class="products-number"><strong>展示</strong><a href="#" class="btn btn-outline-secondary btn-sm">6</a><a href="#" class="btn btn-sm btn-primary">8</a><a href="#" class="btn btn-outline-secondary btn-sm">全部</a><span>产品</span></div>
                      <div class="products-sort-by mt-2 mt-lg-0"><strong>排序</strong>
                        <select name="sort-by" class="form-control">
                          <option>价格升序</option>
                          <option>价格降序</option>
                        </select>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="row products">
				  <!-- /////////////////////////////////// -->
                <div class="col-lg-3 col-md-6" v-for="(item,index) in goodlist" :key="index">
                  <div class="product">
                    <div class="flip-container" @click="ToDetail(item)">
                      <div class="flipper">
                        <div class="front"><a href="detail"><img :src="item.images" alt="" class="img-fluid" ></a></div>
                        <div class="back"><a href="detail"><img :src="item.images" alt="" class="img-fluid"></a></div>
                      </div>
                    </div><a href="detail" class="invisible"><img :src="item.images"
					alt="" class="img-fluid"></a>
                    <div class="text">
                      <h3 @click="ToDetail(item)"><a href="javascript:;">{{item.name}}</a></h3>
                      <p class="price"> 
                        ${{item.price}}
                      </p>
                      <p class="buttons">
						  <a href="detail" @click="ToDetail(item)"
						  class="btn btn-outline-secondary">查看详情</a>
						  <a href="javascript:;" class="btn btn-primary" @click="ShowAddBasket(item)">
							  <i class="fa fa-shopping-cart"></i>加入购物车</a></p>
                    </div>
                  </div>
                </div>
				<!-- /////////////////////////////////// -->
                <!-- /.products-->
              </div>
              <div class="pages">
				  <el-pagination
				    background
					@current-change="ChangePage"
				    layout="prev, pager, next"
				    :total="total">
				  </el-pagination>
              
              </div>
              <el-dialog :title="'('+addbasket.name+')添加至购物车'" :visible.sync="centerDialogVisible">
                <el-form  >
                  <el-form-item label="数量" required>
                    <el-input-number v-model="num"  :min="1"  ></el-input-number>
                  </el-form-item>
                  <el-form-item label="地址"  required>
                    <el-input v-model="address"></el-input>
                  </el-form-item>
                </el-form>
                <div slot="footer" class="dialog-footer">
                  <el-button @click="centerDialogVisible = false">取 消</el-button>
                  <el-button type="primary" @click="AddBasket">确 定</el-button>
                </div>
              </el-dialog>
            </div>
            <!-- /.col-lg-9-->
          </div>
        </div>
      </div>
    </div>
	</div>
    <!--
    *** FOOTER ***
    _________________________________________________________
    -->
   <script>
   	document.write(footer.import.body.innerHTML);
   </script>
    <!-- *** COPYRIGHT END ***-->
    <!-- JavaScript files-->
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/static/vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="/static/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="/static/vendor/owl.carousel2.thumbs/owl.carousel2.thumbs.js"></script>
    <script src="/static/js/front.js"></script>
  </body>
  
  <script type="text/javascript">
		var CIGTcategory=new Vue({
			el:'#CIGTcategory',
			data:{
              centerDialogVisible:false,    //加入购物车弹窗显示参数
              addbasket:{},       //加入购物车商品参数
              num:1,          //数量
              address:null,     //地址

				total:null,		//控制分页页数
				type:{},		//分类标题
				typelist:null,	//商品分类列表
				goodlist:null,	//商品列表
			},
			mounted() {

				//获取商品分类列表
				MyAjax('/api/getCategoryInfo','POST',{})
				.then(res=>{
					 this.typelist=res
					 sessionStorage.setItem('typelist',JSON.stringify(res))
					//是否通过顶部搜索框跳转
					var findgoodlist =sessionStorage.getItem('findgoodlist')
					if(findgoodlist!=null){
						findgoodlist=JSON.parse(findgoodlist)
						this.type.category='搜索结果'
						this.goodlist=findgoodlist
						sessionStorage.removeItem('findgoodlist')
					}else{
						this.type=res[0]
						this.ChangeType(this.type,1)
					}
				})
			},
			methods:{
			  ShowAddBasket(item){
			    this.centerDialogVisible=true
                this.addbasket=item
              },
              //加入购物车
              AddBasket(){
                let userinfo=JSON.parse(sessionStorage.getItem('userinfo'))
                if(userinfo==null){
                  this.$notify({title: '未登录，请先登录',type: 'warning'});
                  return
                }
                if(this.address==null||this.address==''){this.$notify({title: '地址不能为空',type: 'warning'});return}
			    MyAjax('/api/insertShoppingInfo','POST',{
                  goods_id:this.addbasket.id,
                  number:this.num,
                  user_address:this.address,
                  userId:userinfo.id
                }).then(res=>{
                  if(res.code==0){
                    this.$notify({
                      title: '加入购物车成功',
                      type: 'success'
                    });
                    this.centerDialogVisible=false
                  }else{
                    this.$notify.error({
                      title: '加入购物车失败',
                    });
                  }
                })
              },
				//切换页数
				ChangePage(e){
					this.ChangeType(this.type,e)
				},
				//切换分类,并获取对应页数商品
				ChangeType(item,pageNum){
					MyAjax('/api/getLoadmMoreGoodsInfo/'+item.id,'POST',{pageNum:pageNum})
					.then(res=>{
						if(res.code==0){
							this.total=Math.ceil(res.goodsNum/8)*10
							 this.type=item
							 this.goodlist=res.goods
						}else{
							this.$message({message: '网络开小差',type: 'warning'}); 
						}
					})
				},
				//跳转详情页
				ToDetail(item){
					let good={
						type:this.type,
						data:item
					}
					sessionStorage.setItem('good',JSON.stringify(good))
					window.location.href='detail'
				}
			}
		})
  </script>
</html>